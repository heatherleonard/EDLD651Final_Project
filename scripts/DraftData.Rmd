---
title: "DraftDataScript"
author: "Heather Leonard, Abbie Sanders, and Rebecca Gordon"
date: "11/18/2021"
output:
  html_document: default
  pdf_document: default
  bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      eval = TRUE,
                      warning = FALSE,
                      message = FALSE)
```
```{r}
#installing gtsummary to help with creating summary tables
#install.packages("gtsummary")
```


```{r}
library(rio)
library(tidyverse)
library(here)
library(janitor)
library(gtsummary)
library(gt)

```
```{r}
synthdata <- read.csv(here ("data", "synthdata.csv")) %>%
  as_tibble()
```

## Notes for working on final project:
### Final project must use the following functions: pivot_longer(), select(), filter(), mutate(), pivot_wider(), group_by(), and summarize().

## Research question: Is internet overuse associated with sleep outcomes (total sleep, daytime sleepiness) in adolescents?

### Covariates: 

### Child age:
- dm_childage_bl
### Child sex:
- dm_sex_bl
### Welfare status:
- dm_lunch_bl 

### Steps:

1. select() and filter() will be used for narrowing down data to the variables we want
2. recode io variables will use mutate()
3. record age variable will use mutate()
4. create the composite score for io variables
5. in ggplot,  we can examine the relation between internet overuse and age by welfare status
6. summarize() by making a descriptives/summary table, possibly use pivots

### Make composite score for internet overuse, using variables io1_bl, io2_bl, io3_bl, and io4_bl. Levels include i don't know, never, rarely, sometimes, often, (1-5); new code is 0-4 scores with composite range of 0-16.


## Introduction
Inadequate sleep has been linked to a host of negative outcomes in adolescents, including depression, anxiety, substance use, obesity, chronic inflammation, attentional focus, learning, and academic performance.

## Methods
Data were collected from 345 middle school students in the Pacific Northwest. Parents were notified by mail and given the option to opt their student out of the survey. Student assent was collected by research assistants in the classroom prior to administering the survey. Students were compensated for their participation in the study. All procedures were approved by the institutional and school district review boards.

Demographic data collected included age, sex, race/ethnicity, and free/reduced lunch status (used as a stand-in for socioeconomic status). Students were ages 12-14, 53% male and 47% female, and 57% were receiving free/reduced lunch. Ethnicity included 26% identifying as Hispanic or Latino, and race included 33% reporting more than one race, 32% white, 16% unknown, 5% American Indian/native Alaskan, and 3% black/African American.

Total sleep was measured by asking for both weeknights and weekend nights, “what time do you usually go to bed?” and “what time do you usually wake up?” Responses were recorded on a 24-hour scale (range=0-24) and the final variable was created by rounding the difference in reported bedtimes and wake times. Values at the extreme ends were collapsed, and results were summarized into the following categories: 6 hours or less, 6-8 hours, 8-10 hours, and more than 10 hours.

Daytime sleepiness was measured by asking 8 questions (e.g., “how often do you fall asleep or get drowsy during class periods”) with response options ranging from (0) never to (4) always. Participants’ responses were added together to create a composite score (0-32).

Bedtime media use was measured by asking for both weeknights and weekend nights, “in the hour before you go to sleep, how frequently do you use any type of screen media?” Response options ranged from (0) never to (3) often.

Internet overuse was measured by asking 4 questions regarding internet use (e.g., “how often do you have trouble trying to cut down on the amount of time you spend online?” and “how often do your grades or schoolwork have suffered because of the amount of time you spend online?”). Response options ranged from (1) never to (4) often. Responses were added together to create a composite score (0-12). 



Our first citation is @paruthi2016recommended and it includes the sleep recommendations for adolescents. Our second citation is @shochat2014functional and it discusses the consequences of inadequate sleep in adolescents. Our third citatin is @kokka2021exploring and it looks at how internet overuse in adolescents impacts their sleep outcomes. Our fourth citation is @anderson2018teens and it includes a statistic showing that 95 percent of U.S. adolescents (ages 13-17) either own or have exclusive access to a smartphone. Finally, our fifth citation is @rideout2015common and it includes the statistic that nearly half of adolescents' waking time (7.5 hours per day) is spent on screen media devices, not including time spent in school or doing homework. We used the @tidyversepackage on this assignment. 

NEED TO CITE R PACKAGES WE USED!







```{r abbie}
#recode internet overuse score and create a composite score 
synthdata <- synthdata %>%
  mutate(io1_RC = recode(io1_bl, "i don't know" = 0, "never" = 1, "often" = 2, "rarely" = 3, "sometimes" = 4)) %>%
  mutate(io2_RC = recode(io2_bl, "i don't know" = 0, "never" = 1, "often" = 2, "rarely" = 3, "sometimes" = 4)) %>%
  mutate(io3_RC = recode(io3_bl, "i don't know" = 0, "never" = 1, "often" = 2, "rarely" = 3, "sometimes" = 4)) %>%
  mutate(io4_RC = recode(io4_bl, "i don't know" = 0, "never" = 1, "often" = 2, "rarely" = 3, "sometimes" = 4)) %>%
  mutate(io_comp = io1_RC + io2_RC + io3_RC + io4_RC)

#recode age
synthdata$age_RC <- as.numeric(str_sub(synthdata$dm_childage_bl, 1,2)) 

#recode free reduced lunch, I want to make "i don't know" a missing value
synthdata <- synthdata %>%
  mutate(lunch_RC = recode(dm_lunch_bl, "no" = 0, "yes" = 1,"i don't know" = 2))

```


```{r pivotlonger-to-tidy-iodata}
synthdata %>%
  select(1:6, io1_RC:io4_RC)  %>%
  pivot_longer(
    cols = starts_with("io"),
    names_to = "variables",
    values_to = "answers"
  )
```



```{r grouping-and-summarizing}
synthdata %>% 
  group_by(dm_sex_bl) %>% 
  summarise(mean_io = mean(io_comp))
```


```{r grouping-and-summarizing-using-pivot-wider}
synthdata %>% 
  group_by(dm_sex_bl) %>% 
  summarise(mean_io = mean(io_comp)) %>% 
  pivot_wider(names_from = dm_sex_bl, values_from = mean_io)
```


```{r summary-table-of-all-variable}
#this makes a giant table of all variables
synthdata %>% 
  tbl_summary()
```

```{r filter-characteristics-by-sex-and-show-pvalues}
#this will split out the characteristics by sex and add p value with second line. filtered out one gender answer of "other." 

#trying rename
synthdata %>%
  select(grade, dm_childage_bl, dm_sex_bl, dm_ethnic_bl, dm_lunch_bl, dm_race_bl, sl_sleepy_bl, sl_avgsleepcat_bl, io_comp) %>%
  rename (Grade = grade, Age = dm_childage_bl, Sex = dm_sex_bl, Ethnicity = dm_ethnic_bl, "Free/reduced lunch" = dm_lunch_bl, Race = dm_race_bl, "Average daytime sleepiness" = sl_sleepy_bl, "Average weekly hours of sleep per night" = sl_avgsleepcat_bl, "Average internet overuse" = io_comp)


 
```

```{r select-specific-variables-for-summary-table-with-pvalues}
synthdata %>% 
  select(sl_avgsleepcat_bl, io_comp) %>% 
  tbl_summary(by = sl_avgsleepcat_bl) %>% 
  add_p()
```

```{r select-sdifferent-variables-for-summary-table-with-pvalues}
synthdata %>% 
  select(sl_bedmedia_bl, io_comp) %>% 
  tbl_summary(by = sl_bedmedia_bl) %>% 
  add_p()
```
```{r correlation-of-bedtime-media-use-and-internet-overuse}
#answer to our research question: positive relationship that is very very small
cor.test(synthdata$sl_bedmedia_bl, synthdata$io_comp, method = "pearson", use = "complete.obs")

```

```{r correlation-ofinternet-overuse-and-total-sleep-on-schoolnights}
#not really a correlation between internet overuse and total sleep on school nights
cor.test(synthdata$io_comp, synthdata$sl_sleepschool_bl, method = "pearson", use = "complete.obs")
```


```{r correlation-of-internet-overuse-and-daytime-sleepiness}
#positive correlation that is very small
cor.test(synthdata$io_comp, synthdata$sl_sleepy_bl, method = "pearson", use = "complete.obs")
```
```{r correlation-of-internet-overuse-and-welfare-status}
#positive correlation that is very small

cor.test(synthdata$io_comp,as.numeric(synthdata$dm_lunch_bl), method = "pearson", use = "complete.obs")


```

```{r, Rebecca-ggplot}

#Removes all "i don't know" values
synthdata <- synthdata %>% 
filter(synthdata$age_RC != "i don't know" & synthdata$dm_lunch_bl != "i don't know")

synthdata %>% 
  ggplot(aes(io_comp, sl_sleepy_bl)) +
  geom_jitter(aes(color = age_RC)) +
  geom_smooth(method = "lm") +
  facet_wrap(~dm_lunch_bl) +
  labs(title = 'Relation between internet overuse and Daytime sleepiness', subtitle = 'Scatter plot by welfare status', x = 'Internet Overuse score', y = 'Daytime sleepiness', color = 'Age')

synthdata %>% 
  ggplot(aes(io_comp, sl_avgsleepcat_bl)) +
  geom_jitter(aes(color = age_RC)) +
  labs(title = 'Relation between internet overuse and Average Hours of sleep', x = 'Internet Overuse score', y = 'Hours of sleep', color = 'Age')

```



\newpage

# References